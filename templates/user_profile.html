<!DOCTYPE html>
<html>
<head>
    <title>{{ user.username }} - Poetry Vault</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Georgia', serif; background: #1c2532; min-height: 100vh; color: #e8e8e8; }
        .navbar { background: rgba(28, 37, 50, 0.95); border-bottom: 1px solid rgba(212, 175, 55, 0.2); padding: 15px 0; }
        .nav-container { max-width: 700px; margin: 0 auto; padding: 0 20px; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 24px; color: #d4af37; font-weight: 600; text-decoration: none; }
        .btn-back { padding: 8px 16px; background: transparent; color: #d4af37; border: 1px solid #d4af37; border-radius: 6px; text-decoration: none; font-size: 12px; }
        .container { max-width: 700px; margin: 40px auto; padding: 0 20px; }
        .profile-header { background: rgba(28, 37, 50, 0.8); border: 1px solid rgba(212, 175, 55, 0.2); border-radius: 8px; padding: 40px; margin-bottom: 30px; text-align: center; }
        .avatar-large { width: 100px; height: 100px; border-radius: 50%; background: linear-gradient(135deg, #d4af37 0%, #b8956a 100%); display: flex; align-items: center; justify-content: center; color: #1c2532; font-weight: bold; font-size: 42px; margin: 0 auto 20px; }
        .profile-header h1 { color: #d4af37; font-size: 32px; margin-bottom: 10px; font-weight: normal; }
        .profile-header p { color: #8e7a5a; font-size: 14px; font-style: italic; }
        .stats { display: flex; gap: 30px; justify-content: center; margin-top: 20px; }
        .stat { text-align: center; cursor: pointer; transition: transform 0.2s; }
        .stat:hover { transform: scale(1.05); }
        .stat-number { color: #d4af37; font-size: 24px; font-weight: 600; }
        .stat-label { color: #8e7a5a; font-size: 12px; }
        .follow-btn { margin-top: 20px; padding: 12px 40px; background: #d4af37; color: #1c2532; border: none; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .follow-btn:hover { background: #b8956a; }
        .follow-btn.following { background: transparent; color: #d4af37; border: 1px solid #d4af37; }
        .highlights { display: flex; gap: 15px; justify-content: center; margin-top: 25px; flex-wrap: wrap; }
        .highlight { width: 70px; text-align: center; cursor: pointer; }
        .highlight-circle { width: 70px; height: 70px; border-radius: 50%; border: 2px solid #d4af37; display: flex; align-items: center; justify-content: center; background: rgba(212, 175, 55, 0.1); margin-bottom: 5px; }
        .highlight-name { color: #8e7a5a; font-size: 11px; }
        .tabs { display: flex; justify-content: center; gap: 40px; margin-bottom: 30px; border-bottom: 1px solid rgba(212, 175, 55, 0.2); }
        .tab { padding: 15px 0; color: #8e7a5a; cursor: pointer; border-bottom: 2px solid transparent; transition: all 0.2s; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; }
        .tab.active { color: #d4af37; border-bottom-color: #d4af37; }
        .tab:hover { color: #d4af37; }
        .poems-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 4px; }
        .grid-item { aspect-ratio: 1; background: rgba(28, 37, 50, 0.8); border: 1px solid rgba(212, 175, 55, 0.2); cursor: pointer; overflow: hidden; position: relative; transition: all 0.2s; }
        .grid-item:hover { transform: scale(1.02); border-color: #d4af37; }
        .grid-item-content { padding: 15px; height: 100%; display: flex; flex-direction: column; justify-content: center; }
        .grid-poem-title { color: #d4af37; font-size: 14px; font-weight: 600; margin-bottom: 8px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .grid-poem-preview { color: #e8e8e8; font-size: 11px; line-height: 1.4; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 4; line-clamp: 4; -webkit-box-orient: vertical; font-style: italic; }
        .grid-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.7); display: flex; align-items: center; justify-content: center; gap: 20px; opacity: 0; transition: opacity 0.2s; }
        .grid-item:hover .grid-overlay { opacity: 1; }
        .grid-stat { color: #fff; font-size: 14px; font-weight: 600; display: flex; align-items: center; gap: 5px; }
        .empty-state { text-align: center; padding: 60px 20px; color: #8e7a5a; font-style: italic; }
        @media (max-width: 768px) {
            .poems-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="/home" class="logo">
                <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Poetry Vault" style="height: 40px; width: auto; vertical-align: middle;">
            </a>
            <a href="/home" class="btn-back">Back to Home</a>
        </div>
    </nav>
    <div class="container">
        <div class="profile-header">
            <div class="avatar-large">{{ user.username[0].upper() }}</div>
            <h1>{{ user.username }}</h1>
            <p>Muse: {{ user.favorite_poet }}</p>
            <div class="stats">
                <div class="stat"><div class="stat-number">{{ poems|length }}</div><div class="stat-label">Poems</div></div>
                <a href="/user/{{ user.id }}/followers" class="stat" style="text-decoration: none; color: inherit;">
                    <div class="stat-number" id="followers-count">{{ followers_count }}</div>
                    <div class="stat-label">Followers</div>
                </a>
                <a href="/user/{{ user.id }}/following" class="stat" style="text-decoration: none; color: inherit;">
                    <div class="stat-number">{{ following_count }}</div>
                    <div class="stat-label">Following</div>
                </a>
            </div>
            {% if current_user.id != user.id %}
                <button class="follow-btn {% if is_following %}following{% endif %}" id="follow-btn" onclick="toggleFollow({{ user.id }})">
                    {% if is_following %}Following{% else %}Follow{% endif %}
                </button>
            {% endif %}
            {% if highlights %}
            <div class="highlights">
                {% for highlight in highlights %}
                <div class="highlight" onclick="window.location.href='/highlight/{{ highlight.id }}'">
                    <div class="highlight-circle">üìö</div>
                    <div class="highlight-name">{{ highlight.name }}</div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>
        <div class="tabs">
            <div class="tab active">üìù Poems</div>
        </div>
        
        {% if poems %}
        <div class="poems-grid">
            {% for poem in poems %}
            <a href="/poem/{{ poem.id }}" style="text-decoration: none; color: inherit;">
                <div class="grid-item">
                    <div class="grid-item-content">
                        <div class="grid-poem-title">{{ poem.title }}</div>
                        <div class="grid-poem-preview">{{ poem.content }}</div>
                    </div>
                    <div class="grid-overlay">
                        <div class="grid-stat">‚ù§Ô∏è {{ poem.likes|length }}</div>
                        <div class="grid-stat">üí¨ {{ poem.comments|length }}</div>
                    </div>
                </div>
            </a>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            {% if current_user.id == user.id %}
                No poems yet. Share your first verse with the world!
            {% else %}
                {{ user.username }} hasn't shared any poems yet.
            {% endif %}
        </div>
        {% endif %}
    </div>
    <script>
        function toggleFollow(userId) {
            fetch('/user/' + userId + '/follow', {
                method: 'POST',
            }).then(response => response.json())
            .then(data => {
                const btn = document.getElementById('follow-btn');
                const followersCount = document.getElementById('followers-count');
                if (data.action === 'followed') {
                    btn.textContent = 'Following';
                    btn.classList.add('following');
                } else {
                    btn.textContent = 'Follow';
                    btn.classList.remove('following');
                }
                followersCount.textContent = data.followers_count;
            });
        }
    </script>
</body>
</html>
