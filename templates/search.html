<!DOCTYPE html>
<html>
<head>
    <title>Search - Poetry Vault</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Georgia', serif; background: #1c2532; min-height: 100vh; color: #e8e8e8; }
        .navbar { background: rgba(28, 37, 50, 0.95); border-bottom: 1px solid rgba(212, 175, 55, 0.2); padding: 15px 0; }
        .nav-container { max-width: 700px; margin: 0 auto; padding: 0 20px; display: flex; justify-content: space-between; align-items: center; gap: 15px; }
        .logo { font-size: 24px; color: #d4af37; font-weight: 600; text-decoration: none; }
        .search-box { flex: 1; position: relative; }
        .search-box input { width: 100%; padding: 12px 45px 12px 16px; background: rgba(0, 0, 0, 0.4); border: 1px solid rgba(212, 175, 55, 0.3); border-radius: 8px; color: #e8e8e8; font-family: 'Georgia', serif; font-size: 15px; }
        .search-box input:focus { outline: none; border-color: #d4af37; background: rgba(0, 0, 0, 0.6); }
        .search-box input::placeholder { color: rgba(184, 149, 106, 0.5); font-style: italic; }
        .search-icon { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); pointer-events: none; }
        .search-icon svg { width: 20px; height: 20px; stroke: #d4af37; fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
        .btn-back { padding: 8px 16px; background: transparent; color: #d4af37; border: 1px solid #d4af37; border-radius: 6px; text-decoration: none; font-size: 12px; black-space: nowrap; }
        .btn-back:hover { background: rgba(212, 175, 55, 0.1); }
        .container { max-width: 700px; margin: 40px auto; padding: 0 20px; }
        .search-prompt { text-align: center; padding: 80px 30px; color: #8e7a5a; }
        .search-prompt h2 { color: #d4af37; font-size: 28px; margin-bottom: 15px; font-weight: normal; }
        .search-prompt p { font-style: italic; font-size: 16px; }
        .results-header { color: #d4af37; font-size: 22px; margin-bottom: 20px; font-weight: normal; }
        .poem-card { background: rgba(28, 37, 50, 0.8); border: 1px solid rgba(212, 175, 55, 0.2); border-radius: 8px; padding: 25px; margin-bottom: 20px; text-decoration: none; color: inherit; display: block; transition: border-color 0.2s; }
        .poem-card:hover { border-color: rgba(212, 175, 55, 0.4); }
        .poem-title { color: #d4af37; font-size: 20px; margin-bottom: 10px; font-weight: 600; }
        .poem-author { color: #8e7a5a; font-size: 13px; margin-bottom: 15px; }
        .poem-content { color: #e8e8e8; line-height: 1.8; font-style: italic; }
        .no-results { text-align: center; padding: 60px 30px; }
        .no-results h3 { color: #d4af37; font-size: 22px; margin-bottom: 10px; font-weight: normal; }
        .no-results p { color: #8e7a5a; font-style: italic; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="/home" class="logo">Poetry Vault</a>
            <div class="search-box">
                <form action="/search" method="GET">
                    <input type="text" name="q" value="{{ query }}" placeholder="Search poems by title or content..." autofocus>
                    <span class="search-icon">
                        <svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg>
                    </span>
                </form>
            </div>
            <a href="/home" class="btn-back">Cancel</a>
        </div>
    </nav>
    <div class="container">
        {% if query %}
            <div class="results-header">Results for "{{ query }}"</div>
            {% if poems %}
                {% for poem in poems %}
                <a href="/poem/{{ poem.id }}" class="poem-card">
                    <div class="poem-title">{{ poem.title }}</div>
                    <div class="poem-author">by {{ poem.author.username }}</div>
                    <div class="poem-content">{{ poem.content[:200] }}{% if poem.content|length > 200 %}...{% endif %}</div>
                </a>
                {% endfor %}
            {% else %}
                <div class="no-results">
                    <h3>No Results Found</h3>
                    <p>Try searching with different keywords</p>
                </div>
            {% endif %}
        {% else %}
            <div class="search-prompt">
                <h2>Search Poetry Vault</h2>
                <p>Find poems by title, content, or author</p>
            </div>
        {% endif %}
    </div>
<script>
const searchInput = document.querySelector('input[name="q"]');
const autocompleteDiv = document.createElement('div');
autocompleteDiv.className = 'autocomplete-dropdown';
autocompleteDiv.style.cssText = 'position:absolute; background:white; border:1px solid #ddd; max-height:200px; overflow-y:auto; display:none; z-index:1000; width:100%; border-radius:8px; box-shadow:0 4px 6px rgba(0,0,0,0.1);';
searchInput.parentElement.style.position = 'relative';
searchInput.parentElement.appendChild(autocompleteDiv);

searchInput.addEventListener('input', async (e) => {
    const query = e.target.value.trim();
    if (query.length < 1) {
        autocompleteDiv.style.display = 'none';
        return;
    }

    const response = await fetch(`/api/search-poets?q=${encodeURIComponent(query)}`);
    const data = await response.json();

    if (data.poets.length > 0) {
        autocompleteDiv.innerHTML = data.poets.map(poet =>
            `<div class="autocomplete-item" style="padding:10px; cursor:pointer; border-bottom:1px solid #eee; color:black;"
                 onmouseover="this.style.background='#f5f5f5'"
                 onmouseout="this.style.background='white'"
                 onclick="document.querySelector('input[name=q]').value='${poet}'; document.querySelector('form').submit();">
                ${poet}
            </div>`
        ).join('');
        autocompleteDiv.style.display = 'block';
    } else {
        autocompleteDiv.style.display = 'none';
    }
});

// Hide dropdown when clicking outside
document.addEventListener('click', (e) => {
    if (!searchInput.contains(e.target)) {
        autocompleteDiv.style.display = 'none';
    }
});
</script>

</body>
</html>
